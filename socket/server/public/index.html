<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
</head>
<body>
    <h1>Chat App</h1>
    <input type="text" id="message" placeholder="enter message"/>
    <button id="sendbtn">Send</button>
    <div id="msge"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io()
        const sendbtn = document.getElementById('sendbtn')
        const message = document.getElementById('message')
        const allMessage = document.getElementById('msge')

        socket.on('user-message', (msg) => {
            const p = document.createElement('p')
            p.innerText = msg
            allMessage.appendChild(p)
        })

        sendbtn.addEventListener('click', () => {
            socket.emit('message', message.value)
            message.value = ''
        })
    </script>
</body>
</html> -->



<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Chat Application</title>
</head>
<body>
    <div>
        <input id="username" placeholder="Enter username">
        <button onclick="register()">Register</button>
    </div>
    
    <div>
        <h3>Online Users</h3>
        <ul id="users"></ul>
    </div>
    
    <div>
        <input id="roomId" placeholder="Room ID">
        <button onclick="joinRoom()">Join Room</button>
    </div>
    
    <div>
        <h3>Private Chat</h3>
        <input id="toUserId" placeholder="Recipient ID">
        <input id="privateMessage" placeholder="Private message">
        <button onclick="sendPrivateMessage()">Send Private</button>
    </div>
    
    <div>
        <h3>Room Chat</h3>
        <input id="roomMessage" placeholder="Room message">
        <button onclick="sendRoomMessage()">Send to Room</button>
    </div>
    
    <div>
        <h3>Messages</h3>
        <ul id="messages"></ul>
    </div>

    <script src="http://localhost:5000/socket.io/socket.io.js"></script>
    <script>
        // Define socket at the top level
        const socket = io('http://localhost:5000');
        let currentRoom = null;

        // Add error handling for socket connection
        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('connect_error', (error) => {
            console.error('Connection error:', error);
        });

        // Rest of your socket event handlers
        socket.on("registered", (data) => updateUsers(data.onlineUsers));
        socket.on("user-connected", (user) => addUser(user));
        socket.on("user-disconnected", (user) => removeUser(user));
        socket.on("joined-room", (roomId) => currentRoom = roomId);
        
        socket.on("private-message", (data) => {
            addMessage(`Private from ${data.sender}: ${data.message}`);
        });
        
        socket.on("room-message", (data) => {
            const prefix = data.system ? 'System' : `${data.sender}`;
            addMessage(`${prefix}: ${data.message}`);
        });

        function register() {
            const username = document.getElementById('username').value;
            socket.emit('register', username);
        }

        function joinRoom() {
            const roomId = document.getElementById('roomId').value;
            socket.emit('join-room', roomId);
        }

        function sendPrivateMessage() {
            const toUserId = document.getElementById('toUserId').value;
            const message = document.getElementById('privateMessage').value;
            socket.emit('private-message', { toUserId, message });
        }

        function sendRoomMessage() {
            const message = document.getElementById('roomMessage').value;
            socket.emit('room-message', { roomId: currentRoom, message });
        }

        // Rest of your functions remain the same
        function updateUsers(users) {
            const usersList = document.getElementById('users');
            usersList.innerHTML = '';
            users.forEach(([id, username]) => {
                const li = document.createElement('li');
                li.textContent = `${username} (${id})`;
                usersList.appendChild(li);
            });
        }

        function addUser(user) {
            const li = document.createElement('li');
            li.textContent = `${user.username} (${user.id})`;
            document.getElementById('users').appendChild(li);
        }

        function removeUser(user) {
            const userElements = document.getElementById('users').getElementsByTagName('li');
            Array.from(userElements)
                .filter(li => li.textContent.includes(user.id))[0]?.remove();
        }

        function addMessage(message) {
            const li = document.createElement('li');
            li.textContent = message;
            document.getElementById('messages').appendChild(li);
        }
    </script>
</body>
</html>